<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Optimizing Matplotlib Visualizations for Academic Papers | Steven Braun</title> <meta name="author" content="Steven Braun"> <meta name="description" content="In this post we will see few tricks to polish matplotlib figures, making them ready for inclusion in academic papers, i.e. LaTeX generated documents."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://www.steven-braun.com/blog/2021/matplotlib-viz/"> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Steven </span>Braun</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}.center{display:block;margin-left:auto;margin-right:auto}.small{display:block;margin-left:auto;margin-right:auto;width:75%}</style> <div class="post"> <header class="post-header"> <h1 class="post-title">Optimizing Matplotlib Visualizations for Academic Papers</h1> <p class="post-meta">October 27, 2021</p> <p class="post-tags"> <a href="/blog/2021"> <i class="fas fa-calendar fa-sm"></i> 2021 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p><img class="img-fluid rounded z-depth-0 center small" src="/assets/posts/2021-09-29-matplotlib-viz/featured.png" data-zoomable=""></p> <p>Without much talk, lets start with a matplotlib example. Let’s say we want to visualize the <a href="https://arxiv.org/abs/1708.02002" rel="external nofollow noopener" target="_blank">Focal Loss</a> objective for different values of \(\gamma\) w.r.t. the probability of the ground-truth class \(p_c^t\):</p> <p><img class="img-fluid center small" src="/assets/posts/2021-09-29-matplotlib-viz/base.png" data-zoomable=""></p> <p>If we were to include this figure directly into some LaTeX document, it would look like this:</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\documentclass</span><span class="na">[twocolumn]</span><span class="p">{</span>article<span class="p">}</span>
<span class="k">\usepackage</span><span class="p">{</span>blindtext<span class="p">}</span>  <span class="c">% Lorem ipsum filler</span>
<span class="k">\usepackage</span><span class="p">{</span>graphicx<span class="p">}</span>  <span class="c">% includegraphics</span>
<span class="nt">\begin{document}</span>

<span class="nt">\begin{figure}</span>
  <span class="k">\centering</span>
  <span class="k">\includegraphics</span><span class="na">[width=\linewidth]</span><span class="p">{</span>./base.png<span class="p">}</span>
  <span class="k">\caption</span><span class="p">{</span>Lorem ipsum dolor sit amet, consectetuer adipisc-
ing elit. Etiam lobortis facilisis sem. Nullam nec mi et neque
pharetra sollicitudin. Praesent imperdiet mi nec ante. Donec
ullamcorper, felis non sodales commodo, lectus velit ultrices
augue, a dignissim nibh lectus placerat pede.<span class="p">}</span>
<span class="nt">\end{figure}</span>

<span class="c">% Some lipsum filler</span>
<span class="k">\Blindtext</span>
<span class="k">\Blindtext</span>
<span class="nt">\end{document}</span>
</code></pre></div></div> <p><img class="img-fluid rounded z-depth-1" src="/assets/posts/2021-09-29-matplotlib-viz/base-latex.png" data-zoomable=""></p> <p>Now, there are a few things that bug me:</p> <ol> <li>The sans-serif font used in the figure stands in contrast to the serif font used in LaTeX documents</li> <li>The figure font size is smaller than the document font size</li> <li>The axis grid is missing</li> </ol> <p>Note, that point 2. can be okay if you need to save space and have multiple figures next to each other. If you have enough space, you should always ensure the same font size for all your text (including figures and tables). Furthermore, point 3. can be omitted if the exact data/values are not important. For everything else, axis grids are an easy, non-intrusive hint for the reader for a quick comparisons of values.</p> <p>The easiest way to accomplish the above is to use the popular <a href="https://github.com/garrettj403/SciencePlots" rel="external nofollow noopener" target="_blank">SciencePlots</a> python package. It offers multiple matplotlib styles which you can enable via:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">([</span><span class="sh">"</span><span class="s">science</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">grid</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div> <p>The resulting image, then includes grids, increased font size, and uses a serif font.</p> <p><img class="img-fluid center small" src="/assets/posts/2021-09-29-matplotlib-viz/sciplots.png" data-zoomable=""></p> <p>To go one step further, one can adjust the legend box frame to look consistent with the axis frame, i.e. use <code class="language-plaintext highlighter-rouge">black</code> as color and set the linewidth to <code class="language-plaintext highlighter-rouge">0.5</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">legend</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">(</span><span class="n">fancybox</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">)</span>
<span class="n">legend</span><span class="p">.</span><span class="nf">get_frame</span><span class="p">().</span><span class="nf">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</code></pre></div></div> <p><img class="img-fluid center small" src="/assets/posts/2021-09-29-matplotlib-viz/legend.png" data-zoomable=""></p> <h3 id="figure-size">Figure Size</h3> <p>It is helpful to adjust the figure size to the actual size available in your LaTeX document. We can find the length of <code class="language-plaintext highlighter-rouge">\textwidth</code> by adding the following statement somewhere in the source.</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\printinunitsof</span><span class="p">{</span>in<span class="p">}</span><span class="k">\prntlen</span><span class="p">{</span><span class="k">\textwidth</span><span class="p">}</span>
</code></pre></div></div> <p>This will print the <code class="language-plaintext highlighter-rouge">\textwidth</code> variable in inches at the position we have placed it in the document. For the example case with a <code class="language-plaintext highlighter-rouge">twocolumn</code> article class, this returns <code class="language-plaintext highlighter-rouge">3.31314</code> inches. We will now go ahead and make the figure size relative to this base measure by putting the height with a fixed aspect ration in direct relation to the textwidth (and enable an optional scaling factor if necessary for smaller/larger figures):</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">textwidth</span> <span class="o">=</span> <span class="mf">3.31314</span>
<span class="n">aspect_ratio</span> <span class="o">=</span> <span class="mi">6</span><span class="o">/</span><span class="mi">8</span>
<span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">width</span> <span class="o">=</span> <span class="n">textwidth</span> <span class="o">*</span> <span class="n">scale</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">aspect_ratio</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
</code></pre></div></div> <h3 id="pgf-outputs">PGF Outputs</h3> <p>If we export the figure as <code class="language-plaintext highlighter-rouge">.png</code> (or even worse: <code class="language-plaintext highlighter-rouge">.jpg</code>) file, the resulting visualization is rasterized and has fixed height and width. This can lead to, depending on the image size, pixelated results when enlarging the figure for an in-detail inspection by the reader. On the other hand, we can simply export the figure either as a <code class="language-plaintext highlighter-rouge">.pdf</code> file, or even better, use the <code class="language-plaintext highlighter-rouge">.pgf</code> (progressive graphics file) format. The big advance of <code class="language-plaintext highlighter-rouge">.pgf</code> over <code class="language-plaintext highlighter-rouge">.pdf</code> is the fact that <code class="language-plaintext highlighter-rouge">.pgf</code> has no embedded fonts and only tells the latex pgf compiler how to generate the figure from instructions. This leads to the resulting figure in the document body using the very same font for all text as the document text itself.</p> <p>We can enable the <code class="language-plaintext highlighter-rouge">pgf</code> module in matplotlib with the following python preamble:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib</span>
<span class="n">matplotlib</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">"</span><span class="s">pgf</span><span class="sh">"</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="p">.</span><span class="n">rcParams</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">pgf.texsystem</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">pdflatex</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">font.family</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">serif</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">text.usetex</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">pgf.rcfonts</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div> <p>Now we save the figure in the <code class="language-plaintext highlighter-rouge">.pgf</code> format instead of the <code class="language-plaintext highlighter-rouge">.png</code> format.</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- plt.savefig("fig.png")
</span><span class="gi">+ plt.savefig("fig.pgf")
</span></code></pre></div></div> <p>In latex, compiling <code class="language-plaintext highlighter-rouge">.pgf</code> files is provided with the <code class="language-plaintext highlighter-rouge">pgfplots</code> package.</p> <div class="language-latex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">\usepackage</span><span class="p">{</span>pgfplots<span class="p">}</span>
</code></pre></div></div> <p>And replace the <code class="language-plaintext highlighter-rouge">\includegraphics</code> statement with an <code class="language-plaintext highlighter-rouge">\input</code> statement as follows</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gd">- \includegraphics[width=\linewidth]{fig.png}
</span><span class="gi">+ \input{fig.pgf}
</span></code></pre></div></div> <h3 id="final-result">Final Result</h3> <p>With this, we have addressed all issues pointed out earlier on. So let’s compare this directly in the resulting LaTeX output PDF, before (left) and after (right):</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/posts/2021-09-29-matplotlib-viz/base-latex.png" data-zoomable=""> </div> <div class="col-sm mt-3 mt-md-0"> <img class="img-fluid rounded z-depth-1" src="/assets/posts/2021-09-29-matplotlib-viz/final-latex.png" data-zoomable=""> </div> </div> <div class="caption"> Before (left) and after (right) comparison when modifying a matplotlib figure to visually fit into a LaTeX document. We have now fixed the figure dimensions, text size and font, legend borders, and used the pgf format. </div> <p>The updated figure now looks more polished and visually fits into the context of the LaTeX document with higher consistency. For reference, you can find the python script that generated all above figures <a href="/assets/posts/2021-09-29-matplotlib-viz/figures.py">here</a> and the LaTeX document <a href="/assets/posts/2021-09-29-matplotlib-viz/main.tex">here</a>.</p> </div> </article><div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"braun-steven/braun-steven.github.io","data-repo-id":"R_kgDOGIe7LA","data-category":"Comments","data-category-id":"DIC_kwDOGIe7LM4CUi45","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2024 Steven Braun. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>